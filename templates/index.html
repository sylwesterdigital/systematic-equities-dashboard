{% extends "base.html" %}
{% block content %}

<div class="grid cols">
  <section class="card">
    <h3>1) Upload price data (CSV)</h3>
    <p class="pill">Format: <code>date,ticker,close,volume</code> (long form). Example rows:</p>
    <pre class="pill">2024-01-02,AAPL,185.6,51147000
    2024-01-02,MSFT,374.5,19233000</pre>

    <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data">
      <label>CSV file</label>
      <input type="file" name="file" accept=".csv" required>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button type="submit">Upload / Replace</button>
        <a class="pill" href="{{ url_for('download_sample') }}">Download sample CSV</a>
      </div>
    </form>

    {% if has_data %}
    <p style="margin-top:10px">
      Current dataset: <b>{{ rows }} rows</b>,
      tickers: <b>{{ ntickers }}</b>,
      dates: <b>{{ start }} â†’ {{ end }}</b>
    </p>
    {% else %}
    <p style="margin-top:10px;color:#f6c945">No data uploaded yet.</p>
    {% endif %}
  </section>

  <section class="card">
    <h3>2) Configure & run backtest</h3>
    <form action="{{ url_for('run_backtest') }}" method="post">
      <label>Start date</label>
      <input type="date" name="start" value="{{ default_start }}">
      <label>End date</label>
      <input type="date" name="end" value="{{ default_end }}">

      <label>Momentum window (days)</label>
      <input type="number" name="mom_win" value="60" min="20" max="252">

      <label>Skip recent days (gap)</label>
      <input type="number" name="gap" value="5" min="0" max="20">

      <label>Quantile for L/S (top & bottom %)</label>
      <select name="quantile">
        <option value="0.1">10%</option>
        <option value="0.2" selected>20%</option>
        <option value="0.3">30%</option>
      </select>

      <label>Position cap per name</label>
      <input type="number" name="max_pos" value="0.02" step="0.01" min="0.01" max="0.1">

      <label>Turnover cost (bps)</label>
      <input type="number" name="tc_bps" value="10" step="1" min="0" max="100">

      <div style="margin-top:12px">
        <button type="submit">Run Backtest</button>
      </div>
    </form>
  </section>
</div>

{% endblock %}
